<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Crimson Horizon</title>
<link rel="icon" type="image/svg+xml" href="favicon.svg">
<style>
  html, body {
    margin: 0;
    width: 100%;
    height: 100%;
    background: black;
    overflow: hidden;
  }

  #pdf-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
  }

  #pdf-canvas {
    display: block;
    margin: auto;
    position: relative;
  }

  .annotationLayer {
    position: absolute;
    pointer-events: auto;
  }

  .annotationLayer a {
    border: none;
    text-decoration: underline;
    color: #00f;
    background: transparent;
    cursor: pointer;
    position: absolute;
    display: block;
  }
</style>
</head>
<body>
<div id="pdf-wrapper">
  <canvas id="pdf-canvas"></canvas>
  <div id="annotation-layer" class="annotationLayer"></div>
</div>

<script src="pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = 'pdf.worker.min.js';

const url = 'cover.pdf';
const canvas = document.getElementById('pdf-canvas');
const ctx = canvas.getContext('2d');
const annotationLayer = document.getElementById('annotation-layer');
const wrapper = document.getElementById('pdf-wrapper');

async function renderPDF() {
  const pdf = await pdfjsLib.getDocument(url).promise;
  const page = await pdf.getPage(1);

  const viewport = page.getViewport({ scale: 1 });
  const scale = Math.min(
    wrapper.clientWidth / viewport.width,
    wrapper.clientHeight / viewport.height
  );
  const scaled = page.getViewport({ scale });

  // Resize canvas
  canvas.width = scaled.width;
  canvas.height = scaled.height;
  canvas.style.width = `${scaled.width}px`;
  canvas.style.height = `${scaled.height}px`;

  // Center canvas using margins
  canvas.style.marginTop = `${(wrapper.clientHeight - scaled.height) / 2}px`;
  canvas.style.marginLeft = `${(wrapper.clientWidth - scaled.width) / 2}px`;

  // Resize annotation layer to match canvas
  annotationLayer.style.width = `${scaled.width}px`;
  annotationLayer.style.height = `${scaled.height}px`;
  annotationLayer.style.left = canvas.offsetLeft + 'px';
  annotationLayer.style.top = canvas.offsetTop + 'px';
  annotationLayer.innerHTML = '';

  // Render PDF page
  await page.render({ canvasContext: ctx, viewport: scaled }).promise;

  // Get annotations
  const annotations = await page.getAnnotations({ intent: 'display' });

  annotations.forEach(ann => {
    if (ann.subtype === 'Link' && ann.url) {
      const rect = pdfjsLib.Util.normalizeRect(ann.rect);
      const a = document.createElement('a');
      a.href = ann.url;
      a.target = '_blank';
      a.rel = 'noopener noreferrer';

      const view = scaled;
      a.style.left = `${rect[0] * view.scale}px`;
      a.style.top = `${(view.height - rect[3]) * view.scale}px`;
      a.style.width = `${(rect[2] - rect[0]) * view.scale}px`;
      a.style.height = `${(rect[3] - rect[1]) * view.scale}px`;

      annotationLayer.appendChild(a);
    }
  });
}

renderPDF();
window.addEventListener('resize', renderPDF);
</script>
</body>
</html>
